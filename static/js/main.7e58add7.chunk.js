(this.webpackJsonpsea_battle_client=this.webpackJsonpsea_battle_client||[]).push([[0],{133:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},137:function(e,t,n){},138:function(e,t,n){},140:function(e,t,n){},141:function(e,t,n){},197:function(e,t,n){},198:function(e,t,n){},200:function(e,t,n){"use strict";n.r(t);var c=n(0),i=n.n(c),r=n(25),s=n.n(r),a=n(17),o=n(78),l=(n(133),n(5)),u=(n(134),n(135),n(136),n(203)),d=(n(137),n(6)),f=n.n(d),j=(n(138),n(2)),O=function(e){var t=e.y,n=e.x,c=e.isShip,i=e.isSelected,r=e.isWounded,s=e.isKilled,a=e.isShootSelected,o=e.isMissed,l=e.size,u=void 0===l?60:l;return Object(j.jsx)("div",{className:f()("cell",{ship:c||i},{"ship__shoot-selected":a},{"ship__shoot-wounded":r&&!s},{"ship__shoot-missed":o},{"ship__shoot-killed":s}),"data-x":n,"data-y":t,style:{width:u,height:u}})},h=function(e){var t=e.cells,n=e.onMouseOverHandler,c=e.onCellClick,i=e.onContextMenu,r=e.size,s=void 0===r?640:r,a=Math.round((s-s/100*6.25)/10);return Object(j.jsx)("div",{className:"battlefield-wrap",onMouseOut:n,onMouseOver:n,onContextMenu:i,onClick:c,style:{maxWidth:s,minWidth:s},children:Object(j.jsx)("div",{className:"battlefield",children:t&&t.map((function(e){return Object(j.jsx)(O,{x:e.x,y:e.y,isShip:e.isShip,shipId:e.shipId,isSelected:e.isSelected,isAroundZone:e.isAroundZone,size:a,isKilled:e.isKilled,isWounded:e.isWounded,isShootSelected:e.isShootSelected,isMissed:e.isMissed},e._id)}))})})},b=n(54),S=n(26),m=n(204),E=function(e){var t=e.items,n=e.currentShipSize,i=e.addShip,r=e.canAddShip,s=Object(c.useState)(""),a=Object(S.a)(s,2),o=a[0],l=a[1],u=Object(c.useState)(!1),d=Object(S.a)(u,2),f=d[0],O=d[1];Object(c.useEffect)((function(){l(t)}),[t]);var E=function(e,t){for(var c=[],i=function(n){var i=o.filter((function(c){return f?c.y===+t&&c.x===+e+n&&!c.isShip&&!c.isAroundZone:c.y===+t+n&&c.x===+e&&!c.isShip&&!c.isAroundZone}));i.length&&c.push(i[0])},r=0;r<n;r++)i(r);return c},p=function(e,t,c){var i=E(e,t),r=Object(b.a)(o);i.length===n&&i.forEach((function(e){r[r.indexOf(e)].isSelected=c})),l(r)};return Object(j.jsx)(h,{cells:o,onCellClick:function(e){if(e.target.classList.contains("cell")&&r){var t=e.target.dataset.x,c=e.target.dataset.y,s=E(t,c),a=Object(b.a)(o);if(s.length===n){(function(e){var t=[];function n(e){e.length&&t.push(e[0])}return e.forEach((function(e){n(o.filter((function(t){return t.x===e.x-1&&t.y===e.y&&!t.isAroundZone&&!t.isSelected}))),n(o.filter((function(t){return t.x===e.x+1&&t.y===e.y&&!t.isAroundZone&&!t.isSelected}))),n(o.filter((function(t){return t.x===e.x&&t.y===e.y-1&&!t.isAroundZone&&!t.isSelected}))),n(o.filter((function(t){return t.x===e.x&&t.y===e.y+1&&!t.isAroundZone&&!t.isSelected}))),n(o.filter((function(t){return t.x===e.x-1&&t.y===e.y-1&&!t.isAroundZone&&!t.isSelected}))),n(o.filter((function(t){return t.x===e.x+1&&t.y===e.y+1&&!t.isAroundZone&&!t.isSelected}))),n(o.filter((function(t){return t.x===e.x+1&&t.y===e.y-1&&!t.isAroundZone&&!t.isSelected}))),n(o.filter((function(t){return t.x===e.x-1&&t.y===e.y+1&&!t.isAroundZone&&!t.isSelected})))})),t})(s).forEach((function(e){a[a.indexOf(e)].isAroundZone=!0}));var u=Object(m.a)();s.forEach((function(e){a[a.indexOf(e)].isShip=!0,a[a.indexOf(e)].shipId=u})),i()}l(a)}},onMouseOverHandler:function(e){if(e.target.classList.contains("cell")&&r){var t=e.target.dataset.x,n=e.target.dataset.y;"mouseover"===e.type&&p(t,n,!0),"mouseout"===e.type&&p(t,n,!1)}},onContextMenu:function(e){if(e.preventDefault(),e.target.classList.contains("cell")){var t=e.target.dataset.x,n=e.target.dataset.y;p(t,n,!1),O(!f)}},size:640})},p=(n(140),function(e){for(var t=e.size,n=e.count,c=e.isActive,i=e.isEnabled,r=e.onSelectSelected,s=[],a=0;a<t;a++)s.push(Object(j.jsx)("div",{className:f()("ship-selector-cell",{"ship-selector-cell-active":c&&i},{"ship-selector-cell-unenable":!i})},a));return Object(j.jsxs)("div",{className:"ship-selector-wrap",onClick:function(){return r(t)},children:[Object(j.jsx)("div",{className:"ship-selector-ship",children:s}),Object(j.jsx)("h2",{children:n})]})}),v=function(e){var t=e.selectrors,n=e.currentSelector,c=e.onSelectSelected;return e.visible?Object(j.jsx)("div",{className:"ship-selector",children:Object(j.jsx)("div",{children:t.map((function(e){return Object(j.jsx)(p,{size:e.size,onSelectSelected:c,count:e.count,isEnabled:e.count>0,isActive:n===e.size},e.size)}))})}):Object(j.jsx)("div",{})},C=(n(141),n(123)),_=n(206),x=n(207),y=function(e){var t=e.joinToken,n=e.enterClick,c=e.nickName,i=e.setNickName,r="http://".concat(window.location.hostname,":3000/join/").concat(t);return Object(j.jsx)("div",{className:"home",children:Object(j.jsxs)("div",{className:"home-wrap",children:[Object(j.jsx)("div",{className:"home-wrap-left",children:Object(j.jsx)("h1",{children:"SEA battle"})}),Object(j.jsx)("div",{className:"home-wrap-right",children:t?Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"home-wrap-right-link",onClick:function(){var e=document.createElement("textarea");e.innerText=r,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),C.a.open({message:"Link copied to clipboard",description:"Send link to your friend to start the game! Good luck =)",icon:Object(j.jsx)(_.a,{style:{color:"#108ee9"}})})},children:[Object(j.jsxs)("div",{className:"link-container",children:[Object(j.jsx)(x.a,{className:"link-icon"}),Object(j.jsx)("input",{readOnly:!0,className:"link-container-text",value:r})]}),Object(j.jsx)("h5",{children:"join link"})]})}):Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"home-wrap-right-nameform",children:[Object(j.jsx)("h1",{children:"Enter your name"}),Object(j.jsx)("input",{className:"name-input",value:c,onChange:function(e){return i(e.target.value)}})]}),Object(j.jsx)("h2",{onClick:n,children:"GO"})]})})]})})},g=n(71),N=n.n(g);N.a.defaults.baseURL="https://71b97646a690.ngrok.io",console.log(Object({NODE_ENV:"production",PUBLIC_URL:"/sea_battle_client",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER),N.a.interceptors.request.use((function(e){var t=localStorage.getItem("gameId"),n=localStorage.getItem("userId");return t&&(e.headers.gameid=t,e.headers.userid=n),e}),(function(e){return Promise.reject(e)}));var G=N.a,I={createGame:function(e){return G.post("/create",e)},index:function(){return G.get("/index")},join:function(e){return G.post("/join",e)},cells:function(){return G.get("/cell")},enemyCells:function(){return G.get("/cell/enemy")},setCells:function(e){return G.post("/cell",e)},shoot:function(e){return G.post("/cell/shoot",e)}},A={"set\u0421urrentSize":function(e){return{type:"GAMECONFIG:SET_CURRENT_SIZE",payload:e}},addShip:function(){return{type:"GAMECONFIG:SET_SHIP"}},readyCheck:function(){return{type:"GAMECONFIG:READY_CHECK"}},setShip:function(){return function(e){e(A.addShip()),e(A.readyCheck())}},setGameData:function(e){return{type:"GAMECONFIG:SET_GAME_DATA",payload:e}},setGameStatus:function(e){return{type:"GAMECONFIG:SET_GAME_STATUS",payload:e}},fetchGameInfo:function(){return function(e){return I.index().then((function(t){var n=t.data;e(A.setGameData(n))}))}},fetchCreateGame:function(e){return function(t){return I.createGame(e).then((function(e){var n=e.data;return window.localStorage.setItem("gameId",null===n||void 0===n?void 0:n._id),window.localStorage.setItem("userId",null===n||void 0===n?void 0:n.userA),t(A.setGameData(n)),n}))}},fetchJoinGame:function(e){return function(t){return I.join(e).then((function(e){var t=e.data;return"success"===(null===t||void 0===t?void 0:t.status)&&(window.localStorage.setItem("gameId",null===t||void 0===t?void 0:t.game._id),window.localStorage.setItem("userId",null===t||void 0===t?void 0:t.user)),t}))}},fetchGetCells:function(){return function(e){return I.cells().then((function(t){var n=t.data;n&&n.cells&&e(A.setCells(n.cells))}))}},fetchGetEnemyCells:function(){return function(e){return I.enemyCells().then((function(t){var n=t.data;n&&n.cells&&e(A.setEnemyCells(n.cells))}))}},fetchSetCells:function(e){return function(t){return I.setCells(e).then((function(e){var n=e.data;return"success"===n.status&&t(A.setUserReady(!0)),n}))}},fetchShoot:function(e){return function(t){return I.shoot(e).then((function(e){var n=e.data;return"success"===n.status&&t(A.setUserReady(!0)),n}))}},setCells:function(e){return{type:"GAMECONFIG:SET_CELLS",payload:e}},setEnemyCells:function(e){return{type:"GAMECONFIG:SET_ENEMY_CELLS",payload:e}},setUserReady:function(e){return{type:"GAMECONFIG:SET_USER_READY",payload:e}},setWoundedCell:function(e){return{type:"GAMECONFIG:SET_WOUNDED_CELL",payload:e}},setMissedCell:function(e){return{type:"GAMECONFIG:SET_MISSED_CELL",payload:e}},setKilledCells:function(e){return{type:"GAMECONFIG:SET_KILL_CELL",payload:e}},setMyWoundedCell:function(e){return{type:"GAMECONFIG:SET_MY_WOUNDED_CELL",payload:e}},setMyMissedCell:function(e){return{type:"GAMECONFIG:SET_MY_MISSED_CELL",payload:e}},setMyKilledCells:function(e){return{type:"GAMECONFIG:SET_MY_KILL_CELL",payload:e}},setCanShoot:function(e){return{type:"GAMECONFIG:SET_CAN_SHOOT",payload:e}}},M=A,T=n(119),L=n.n(T)()("https://71b97646a690.ngrok.io"),F=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.cells,n=e.currentShipSize,i=e.setShip,r=e.canAddShip,s=e.fetchGetCells,a=e.fetchGameInfo,o=e.userReady;e.userId;return Object(c.useEffect)((function(){0===t.length&&s(),L.on("SERVER:SET_CONFIG",(function(){a()}))}),[]),Object(j.jsx)(E,{items:t,currentShipSize:n,addShip:i,canAddShip:r&&!o})})),w=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.selectrors,n=e.currentShipSize,c=e.set\u0421urrentSize,i=e.userReady;return Object(j.jsx)(v,{currentSelector:n,selectrors:t,onSelectSelected:c,visible:!i})})),R=n(208),k=n(205),D=Object(j.jsx)(R.a,{style:{fontSize:200},spin:!0}),z=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.readyToBattle,n=e.cells,i=e.fetchSetCells,r=e.userReady;Object(c.useEffect)((function(){l(r)}),[r]);var s=Object(c.useState)(!1),a=Object(S.a)(s,2),o=a[0],l=a[1];return t&&!o?Object(j.jsx)("div",{className:"ready-button",onClick:function(){l(!0),i({cells:n})},children:Object(j.jsx)("h1",{children:"READY"})}):o?Object(j.jsx)(k.a,{indicator:D}):Object(j.jsx)("div",{})})),U=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.cells,n=e.fetchGetCells;return Object(c.useEffect)((function(){0===t.length&&n()}),[t]),Object(j.jsx)(h,{size:520,cells:t})})),W=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.enemyCells,n=e.fetchGetEnemyCells,i=e.fetchShoot,r=e.canShoot,s=e.setWoundedCell,a=e.setMissedCell,o=e.setKilledCells,l=e.setCanShoot,u=Object(c.useState)(""),d=Object(S.a)(u,2),f=d[0],O=d[1];Object(c.useEffect)((function(){0===t.length?n():O(t)}),[t]);var m=function(e,n,c){var i=E(e,n),r=Object(b.a)(t);1===i.length&&i.forEach((function(e){r[r.indexOf(e)].isShootSelected=c})),O(r)},E=function(e,t){var n=[],c=f.filter((function(n){return n.y===+t&&n.x===+e&&!n.isKilled&&!n.isWounded&&!n.isAroundZone}));return c.length&&n.push(c[0]),n};return Object(j.jsx)(h,{size:520,cells:f,onMouseOverHandler:function(e){if(e.target.classList.contains("cell")&&r){var t=e.target.dataset.x,n=e.target.dataset.y;"mouseover"===e.type&&m(t,n,!0),"mouseout"===e.type&&m(t,n,!1)}},onCellClick:function(e){if(e.target.classList.contains("cell")&&r){var t=e.target.dataset.x,n=e.target.dataset.y,c=E(t,n);1===c.length&&i({cellId:c[0]._id}).then((function(e){var t=e.status,n=e.cell,c=e.cells;switch(t){case"wounded":s(n);break;case"missed":a(n),l(!1);break;case"killed":o(c)}}))}}})})),K=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.canShoot,n=e.userId,i=e.setMyKilledCells,r=e.setMyWoundedCell,s=e.setMyMissedCell,a=e.setCanShoot;return Object(c.useEffect)((function(){L.on("SERVER:KILLED",(function(e){if(e){var t=JSON.parse(e);t.shootUser!==n&&i(t.cells)}})),L.on("SERVER:WOUNDED",(function(e){if(e){var t=JSON.parse(e);t.shootUser!==n&&r(t.cell)}})),L.on("SERVER:MISSED",(function(e){if(e){var t=JSON.parse(e);t.shootUser!==n&&(s(t.cell),a(!0))}}))}),[]),Object(j.jsx)("div",{className:f()("middle-zone",{"middle-zone__can_shoot":t}),children:t?"Let's shoot!":"Wait..."})})),Z=u.a.Step,Y=function(){return Object(j.jsx)("div",{className:"platform",children:Object(j.jsxs)("div",{className:"platform-middle",children:[Object(j.jsx)(w,{}),Object(j.jsx)(F,{}),Object(j.jsxs)("div",{className:"platform-middle-right",children:[Object(j.jsxs)(u.a,{direction:"vertical",current:1,children:[Object(j.jsx)(Z,{title:"Friend join",description:"Friend join to the game."}),Object(j.jsx)(Z,{title:"Fill battlefield",description:"Need set all ships and start the game."})]}),Object(j.jsx)(z,{})]})]})})},H=(n(197),Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.fetchCreateGame,n=e.setGameData,i=e.joinToken,r=(e._id,Object(c.useState)("")),s=Object(S.a)(r,2),a=s[0],o=s[1];return Object(c.useEffect)((function(){L.on("SERVER:USER_JOINED",(function(e){if(e){var t=JSON.parse(e);n(t)}}))}),[]),Object(j.jsx)(y,{enterClick:function(){t({userName:a})},joinToken:i,nickName:a,setNickName:o})}))),P=(n(198),function(){for(var e=[],t=0;t<10;t++)for(var n=0;n<10;n++)e.push({_id:n+" "+t,x:n,y:t});return Object(j.jsxs)("div",{className:"b-platform",children:[Object(j.jsx)("div",{className:"b-platform__battlefield",children:Object(j.jsx)(U,{})}),Object(j.jsx)("div",{className:"b-platform__middle-zone",children:Object(j.jsx)(K,{})}),Object(j.jsx)("div",{className:"b-platform__battlefield",children:Object(j.jsx)(W,{})})]})}),J=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.history,n=e._id,i=e.fetchJoinGame,r=e.fetchGameInfo,s=Object(c.useState)(""),a=Object(S.a)(s,2),o=a[0],l=a[1];Object(c.useEffect)((function(){n&&t.push("/")}),[n]);return Object(j.jsx)(y,{setNickName:l,nickName:o,enterClick:function(){var e=window.location.pathname.split("join/")[1];i({userB:o,joinToken:e}).then((function(e){"success"===e.status&&r()}))}})})),V=n(15),B=function(e){switch(e.gameStatus){case"home":return Object(j.jsx)(H,Object(l.a)({},e));case"config":return Object(j.jsx)(Y,Object(l.a)({},e));case"game":return Object(j.jsx)(P,Object(l.a)({},e));default:return Object(j.jsx)("div",{})}},X=function(e){return Object(j.jsx)(j.Fragment,{children:B(e)})};for(var q=Object(a.b)((function(e){var t=e.gameConfigs;return Object(l.a)({},t)}),M)((function(e){var t=e.status,n=e._id,i=e.fetchGameInfo,r=e.setGameStatus;return Object(c.useEffect)((function(){n&&L.emit("join",n)}),[n]),Object(c.useEffect)((function(){n?i():"home"!==t&&r("home")}),[]),Object(j.jsxs)("div",{className:"app",children:[Object(j.jsx)("div",{className:"header-logo",children:"SEA battle"}),Object(j.jsxs)(V.c,{children:[Object(j.jsx)(V.a,{path:["/join"],component:J}),Object(j.jsx)(V.a,{path:"/",render:function(e){return Object(j.jsx)(X,Object(l.a)({gameStatus:t},e))}})]})]})})),Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,209)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),i(e),r(e),s(e)}))},$=n(34),ee=n(121),te=[],ne=0;ne<10;ne++)for(var ce=0;ce<10;ce++)te.push({_id:ce+" "+ne,x:ce,y:ne});var ie={cells:[]},re={_id:window.localStorage.gameId,userId:window.localStorage.userId,cells:[],enemyCells:[],status:"",currentShipSize:1,canAddShip:!0,readyToBattle:!1,canShoot:!1,selectrors:[{name:"one",size:1,count:4},{name:"two",size:2,count:3},{name:"three",size:3,count:2},{name:"four",size:4,count:1}],readyUsers:[]},se=function(e,t){var n=e.y,c=t.y,i=e.x,r=t.x;return n===c?i<r?-1:i>r?1:0:n<c?-1:1},ae=Object($.c)({battlefield:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0;t.type,t.payload;return e},gameConfigs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case"GAMECONFIG:SET_CURRENT_SIZE":return Object(l.a)(Object(l.a)({},e),{},{currentShipSize:c,canAddShip:e.selectrors.filter((function(e){return e.size===c}))[0].count>0});case"GAMECONFIG:SET_SHIP":return Object(l.a)(Object(l.a)({},e),{},{selectrors:e.selectrors.map((function(t){return t.size===e.currentShipSize?Object(l.a)(Object(l.a)({},t),{},{count:t.count-1}):t})),canAddShip:e.selectrors.filter((function(t){return t.size===e.currentShipSize}))[0].count-1>0});case"GAMECONFIG:READY_CHECK":return Object(l.a)(Object(l.a)({},e),{},{readyToBattle:0===e.selectrors.filter((function(e){return 0!==e.count})).length});case"GAMECONFIG:SET_GAME_DATA":return Object(l.a)(Object(l.a)(Object(l.a)({},e),c),{},{userReady:-1!==(null===c||void 0===c?void 0:c.readyUsers.indexOf(window.localStorage.getItem("userId"))),canShoot:(null===c||void 0===c?void 0:c.currentRoundUser)===window.localStorage.getItem("userId")});case"GAMECONFIG:SET_GAME_STATUS":return Object(l.a)(Object(l.a)({},e),{},{status:c});case"GAMECONFIG:SET_CELLS":return Object(l.a)(Object(l.a)({},e),{},{cells:c});case"GAMECONFIG:SET_USER_READY":return Object(l.a)(Object(l.a)({},e),{},{userReady:c});case"GAMECONFIG:SET_ENEMY_CELLS":return Object(l.a)(Object(l.a)({},e),{},{enemyCells:c});case"GAMECONFIG:SET_WOUNDED_CELL":return Object(l.a)(Object(l.a)({},e),{},{enemyCells:e.enemyCells.map((function(e){return e._id===c._id?c:e}))});case"GAMECONFIG:SET_MY_WOUNDED_CELL":return Object(l.a)(Object(l.a)({},e),{},{cells:e.cells.map((function(e){return e._id===c._id?c:e}))});case"GAMECONFIG:SET_MISSED_CELL":return Object(l.a)(Object(l.a)({},e),{},{enemyCells:e.enemyCells.map((function(e){return e._id===c._id?c:e}))});case"GAMECONFIG:SET_MY_MISSED_CELL":return Object(l.a)(Object(l.a)({},e),{},{cells:e.cells.map((function(e){return e._id===c._id?c:e}))});case"GAMECONFIG:SET_KILL_CELL":var i=e.enemyCells.filter((function(e){return!c.some((function(t){return t._id===e._id}))}));return Object(l.a)(Object(l.a)({},e),{},{enemyCells:i.concat(c).sort(se)});case"GAMECONFIG:SET_MY_KILL_CELL":var r=e.cells.filter((function(e){return!c.some((function(t){return t._id===e._id}))}));return Object(l.a)(Object(l.a)({},e),{},{cells:r.concat(c).sort(se)});case"GAMECONFIG:SET_CAN_SHOOT":return Object(l.a)(Object(l.a)({},e),{},{canShoot:c});default:return e}}}),oe="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||$.d,le=[ee.a],ue=Object($.e)(ae,oe($.a.apply(void 0,le)));s.a.render(Object(j.jsx)(i.a.StrictMode,{children:Object(j.jsx)(o.a,{children:Object(j.jsx)(a.a,{store:ue,children:Object(j.jsx)(q,{})})})}),document.getElementById("root")),Q()}},[[200,1,2]]]);
//# sourceMappingURL=main.7e58add7.chunk.js.map